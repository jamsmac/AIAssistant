# üí≥ –ö—Ä–µ–¥–∏—Ç–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ —Å –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –í—ã–±–æ—Ä–æ–º –ú–æ–¥–µ–ª–µ–π

**–ö–æ–Ω—Ü–µ–ø—Ü–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∑–∞ –∫—Ä–µ–¥–∏—Ç—ã, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–µ –º–æ–¥–µ–ª–∏

---

## üéØ –ö–∞–∫ –≠—Ç–æ –†–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –†–∞–±–æ—Ç—ã:

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫—É–ø–∞–µ—Ç –∫—Ä–µ–¥–∏—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, $10 = 1000 –∫—Ä–µ–¥–∏—Ç–æ–≤)
   ‚Üì
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å (–±–µ–∑ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏)
   ‚Üì
3. –°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å
   - –°–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ä–µ–π—Ç–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π
   - –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á–∏
   - –û—Ü–µ–Ω–∏–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å
   ‚Üì
4. –í—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
   ‚Üì
5. –°–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∫—Ä–µ–¥–∏—Ç—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏)
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã
```

### –ü—Ä–∏–º–µ—Ä:

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ù–∞–ø–∏—à–∏ –∫–æ–¥ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –º–∞—Å—Å–∏–≤–∞"
‚Üì
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç GPT-3.5-turbo
‚Üì
–°—Ç–æ–∏–º–æ—Å—Ç—å: 2 –∫—Ä–µ–¥–∏—Ç–∞
‚Üì
–ë–∞–ª–∞–Ω—Å: 1000 ‚Üí 998 –∫—Ä–µ–¥–∏—Ç–æ–≤
```

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–°–æ–∑–¥–∞–π —Å–ª–æ–∂–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤"
‚Üì
–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç Claude-3-opus
‚Üì
–°—Ç–æ–∏–º–æ—Å—Ç—å: 15 –∫—Ä–µ–¥–∏—Ç–æ–≤
‚Üì
–ë–∞–ª–∞–Ω—Å: 998 ‚Üí 983 –∫—Ä–µ–¥–∏—Ç–∞
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞ –ö—Ä–µ–¥–∏—Ç–æ–≤ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
CREATE TABLE user_credits (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL UNIQUE,
    balance INTEGER NOT NULL DEFAULT 0,        -- –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤
    total_purchased INTEGER DEFAULT 0,         -- –í—Å–µ–≥–æ –∫—É–ø–ª–µ–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
    total_spent INTEGER DEFAULT 0,             -- –í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
CREATE INDEX idx_user_credits_user ON user_credits(user_id);
```

### 2. –¢–∞–±–ª–∏—Ü–∞ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ö—Ä–µ–¥–∏—Ç–æ–≤

```sql
CREATE TABLE credit_transactions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    type TEXT NOT NULL,                        -- 'purchase', 'spend', 'refund', 'bonus'
    amount INTEGER NOT NULL,                   -- –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è purchase, –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –¥–ª—è spend
    balance_before INTEGER NOT NULL,
    balance_after INTEGER NOT NULL,
    description TEXT,                          -- –ù–∞–ø—Ä–∏–º–µ—Ä: "Used GPT-4 for code generation"
    request_id INTEGER,                        -- –°—Å—ã–ª–∫–∞ –Ω–∞ requests (–µ—Å–ª–∏ —ç—Ç–æ —Ä–∞—Å—Ö–æ–¥)
    payment_id INTEGER,                        -- –°—Å—ã–ª–∫–∞ –Ω–∞ payments (–µ—Å–ª–∏ —ç—Ç–æ –ø–æ–∫—É–ø–∫–∞)
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (request_id) REFERENCES requests(id),
    FOREIGN KEY (payment_id) REFERENCES payments(id)
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_credit_trans_user ON credit_transactions(user_id);
CREATE INDEX idx_credit_trans_type ON credit_transactions(type);
CREATE INDEX idx_credit_trans_created ON credit_transactions(created_at);
```

### 3. –¢–∞–±–ª–∏—Ü–∞ –ü–∞–∫–µ—Ç–æ–≤ –ö—Ä–µ–¥–∏—Ç–æ–≤ (Credit Packages)

```sql
CREATE TABLE credit_packages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                        -- "Starter", "Professional", "Enterprise"
    credits INTEGER NOT NULL,                  -- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—Ä–µ–¥–∏—Ç–æ–≤
    price_usd REAL NOT NULL,                   -- –¶–µ–Ω–∞ –≤ USD
    bonus_credits INTEGER DEFAULT 0,           -- –ë–æ–Ω—É—Å–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã
    discount_percentage REAL DEFAULT 0,        -- –°–∫–∏–¥–∫–∞ (%)
    is_active INTEGER DEFAULT 1,
    display_order INTEGER DEFAULT 0,
    created_at TEXT DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP
);

-- –ü—Ä–∏–º–µ—Ä—ã –ø–∞–∫–µ—Ç–æ–≤:
INSERT INTO credit_packages (name, credits, price_usd, bonus_credits, discount_percentage, display_order) VALUES
('Starter', 100, 10, 0, 0, 1),              -- $10 = 100 –∫—Ä–µ–¥–∏—Ç–æ–≤ ($0.10 –∑–∞ –∫—Ä–µ–¥–∏—Ç)
('Basic', 500, 45, 25, 10, 2),              -- $45 = 500+25 –∫—Ä–µ–¥–∏—Ç–æ–≤, —Å–∫–∏–¥–∫–∞ 10%
('Professional', 1000, 80, 100, 20, 3),     -- $80 = 1000+100 –∫—Ä–µ–¥–∏—Ç–æ–≤, —Å–∫–∏–¥–∫–∞ 20%
('Enterprise', 5000, 350, 750, 30, 4);      -- $350 = 5000+750 –∫—Ä–µ–¥–∏—Ç–æ–≤, —Å–∫–∏–¥–∫–∞ 30%
```

### 4. –¢–∞–±–ª–∏—Ü–∞ –°—Ç–æ–∏–º–æ—Å—Ç–∏ –ú–æ–¥–µ–ª–µ–π –≤ –ö—Ä–µ–¥–∏—Ç–∞—Ö

```sql
CREATE TABLE model_credit_costs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    provider TEXT NOT NULL,
    model TEXT NOT NULL,
    credits_per_1k_tokens INTEGER NOT NULL,    -- –°—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö
    base_cost_usd REAL NOT NULL,               -- –ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ USD (–¥–ª—è —Å–ø—Ä–∞–≤–∫–∏)
    markup_percentage REAL NOT NULL,           -- –ù–∞—Ü–µ–Ω–∫–∞ (%)
    is_active INTEGER DEFAULT 1,
    updated_at TEXT DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(provider, model)
);

-- –ü—Ä–∏–º–µ—Ä—ã —Å—Ç–æ–∏–º–æ—Å—Ç–∏:
INSERT INTO model_credit_costs (provider, model, credits_per_1k_tokens, base_cost_usd, markup_percentage) VALUES
-- –î–µ—à–µ–≤—ã–µ –º–æ–¥–µ–ª–∏ (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á)
('openai', 'gpt-3.5-turbo', 2, 0.002, 20),           -- 2 –∫—Ä–µ–¥–∏—Ç–∞ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
('google', 'gemini-pro', 1, 0.00025, 20),            -- 1 –∫—Ä–µ–¥–∏—Ç –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
('anthropic', 'claude-3-haiku', 3, 0.0025, 20),      -- 3 –∫—Ä–µ–¥–∏—Ç–∞ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤

-- –°—Ä–µ–¥–Ω–∏–µ –º–æ–¥–µ–ª–∏ (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∑–∞–¥–∞—á)
('openai', 'gpt-4-turbo', 10, 0.01, 20),             -- 10 –∫—Ä–µ–¥–∏—Ç–æ–≤ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
('anthropic', 'claude-3-sonnet', 4, 0.003, 20),      -- 4 –∫—Ä–µ–¥–∏—Ç–∞ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤

-- –î–æ—Ä–æ–≥–∏–µ –º–æ–¥–µ–ª–∏ (–¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á)
('openai', 'gpt-4', 30, 0.03, 20),                   -- 30 –∫—Ä–µ–¥–∏—Ç–æ–≤ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
('anthropic', 'claude-3-opus', 18, 0.015, 20),       -- 18 –∫—Ä–µ–¥–∏—Ç–æ–≤ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
('openai', 'o1-preview', 150, 0.15, 20);             -- 150 –∫—Ä–µ–¥–∏—Ç–æ–≤ –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
```

### 5. –¢–∞–±–ª–∏—Ü–∞ –†–µ–π—Ç–∏–Ω–≥–æ–≤ –ú–æ–¥–µ–ª–µ–π (—É–∂–µ –µ—Å—Ç—å)

```sql
-- –†–∞—Å—à–∏—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É
ALTER TABLE ai_model_rankings ADD COLUMN use_case TEXT;  -- 'coding', 'writing', 'analysis', 'general'
ALTER TABLE ai_model_rankings ADD COLUMN complexity TEXT; -- 'simple', 'medium', 'complex'
ALTER TABLE ai_model_rankings ADD COLUMN cost_tier TEXT;  -- 'cheap', 'medium', 'expensive'

-- –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö:
UPDATE ai_model_rankings SET 
    use_case = 'coding',
    complexity = 'simple',
    cost_tier = 'cheap'
WHERE model_name = 'gpt-3.5-turbo' AND category = 'code_generation';

UPDATE ai_model_rankings SET 
    use_case = 'coding',
    complexity = 'complex',
    cost_tier = 'expensive'
WHERE model_name = 'gpt-4' AND category = 'code_generation';
```

---

## ü§ñ –°–∏—Å—Ç–µ–º–∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –í—ã–±–æ—Ä–∞ –ú–æ–¥–µ–ª–µ–π

### Backend: Model Selector

```python
# agents/model_selector.py
from typing import Dict, Optional, List
from agents.database import HistoryDatabase
import re

class ModelSelector:
    """
    –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
    - –¢–∏–ø–∞ –∑–∞–¥–∞—á–∏
    - –°–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
    - –†–µ–π—Ç–∏–Ω–≥–∞ –º–æ–¥–µ–ª–µ–π
    - –ë—é–¥–∂–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    """
    
    def __init__(self, db: HistoryDatabase):
        self.db = db
        
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏
        self.task_keywords = {
            'coding': ['–∫–æ–¥', 'code', '–ø—Ä–æ–≥—Ä–∞–º–º', 'function', 'class', 'debug', '–æ—à–∏–±–∫–∞'],
            'writing': ['–Ω–∞–ø–∏—à–∏', 'write', '—Å—Ç–∞—Ç—å—è', 'article', '—Ç–µ–∫—Å—Ç', 'essay'],
            'analysis': ['–∞–Ω–∞–ª–∏–∑', 'analyze', 'compare', 'evaluate', 'review'],
            'translation': ['–ø–µ—Ä–µ–≤–µ–¥', 'translate', 'translation'],
            'math': ['–≤—ã—á–∏—Å–ª–∏', 'calculate', '—Ñ–æ—Ä–º—É–ª–∞', 'equation', 'math'],
        }
        
        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ –¥–ª–∏–Ω–µ –∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        self.complexity_indicators = {
            'simple': ['–ø—Ä–æ—Å—Ç–æ–π', 'simple', 'quick', '–±—ã—Å—Ç—Ä–æ'],
            'complex': ['—Å–ª–æ–∂–Ω—ã–π', 'complex', 'detailed', 'comprehensive', '–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞']
        }
    
    def analyze_prompt(self, prompt: str) -> Dict:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        """
        prompt_lower = prompt.lower()
        
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –∑–∞–¥–∞—á–∏
        task_type = 'general'
        for task, keywords in self.task_keywords.items():
            if any(keyword in prompt_lower for keyword in keywords):
                task_type = task
                break
        
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å
        complexity = 'medium'
        
        # –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞: –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø—Ä–æ—Å—Ç–æ—Ç—ã
        if len(prompt) < 100 or any(kw in prompt_lower for kw in self.complexity_indicators['simple']):
            complexity = 'simple'
        
        # –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞: –¥–ª–∏–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        if len(prompt) > 500 or any(kw in prompt_lower for kw in self.complexity_indicators['complex']):
            complexity = 'complex'
        
        # –û—Ü–µ–Ω–∏—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—É—é –¥–ª–∏–Ω—É –æ—Ç–≤–µ—Ç–∞ (—Ç–æ–∫–µ–Ω—ã)
        estimated_tokens = self._estimate_tokens(prompt)
        
        return {
            'task_type': task_type,
            'complexity': complexity,
            'estimated_tokens': estimated_tokens,
            'prompt_length': len(prompt)
        }
    
    def select_model(self, prompt: str, user_credits: int, 
                     prefer_cheap: bool = False) -> Dict:
        """
        –í—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à—É—é –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
        
        Returns:
            {
                'provider': str,
                'model': str,
                'estimated_cost_credits': int,
                'reason': str
            }
        """
        # –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å
        analysis = self.analyze_prompt(prompt)
        
        # –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞
        models = self.db.get_top_models_for_task(
            task_type=analysis['task_type'],
            complexity=analysis['complexity']
        )
        
        # –ï—Å–ª–∏ –Ω–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π, –≤–∑—è—Ç—å –æ–±—â–∏–µ
        if not models:
            models = self.db.get_top_models_for_task(
                task_type='general',
                complexity=analysis['complexity']
            )
        
        # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö
        models_with_cost = []
        for model in models:
            cost_info = self.db.get_model_cost_credits(
                provider=model['provider'],
                model=model['model_name']
            )
            if cost_info:
                estimated_cost = self._estimate_request_cost(
                    analysis['estimated_tokens'],
                    cost_info['credits_per_1k_tokens']
                )
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ö–≤–∞—Ç–∏—Ç –ª–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
                if estimated_cost <= user_credits:
                    models_with_cost.append({
                        'provider': model['provider'],
                        'model': model['model_name'],
                        'rank': model['rank'],
                        'score': model['score'],
                        'estimated_cost': estimated_cost,
                        'cost_tier': cost_info['cost_tier']
                    })
        
        if not models_with_cost:
            raise Exception("Insufficient credits for any available model")
        
        # –í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å
        if prefer_cheap:
            # –í—ã–±—Ä–∞—Ç—å —Å–∞–º—É—é –¥–µ—à–µ–≤—É—é —Å —Ö–æ—Ä–æ—à–∏–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º
            selected = min(models_with_cost, 
                         key=lambda x: (x['estimated_cost'], -x['score']))
        else:
            # –í—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É —Å —É—á–µ—Ç–æ–º —Å—Ç–æ–∏–º–æ—Å—Ç–∏
            # –ë–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —Ü–µ–Ω–æ–π
            for model in sorted(models_with_cost, key=lambda x: x['rank']):
                # –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤ —Ç–æ–ø-3 –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Ü–µ–Ω–µ, –≤—ã–±–∏—Ä–∞–µ–º –µ—ë
                if model['rank'] <= 3:
                    selected = model
                    break
            else:
                # –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–ø–æ–≤—ã—Ö, –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é
                selected = models_with_cost[0]
        
        return {
            'provider': selected['provider'],
            'model': selected['model'],
            'estimated_cost_credits': selected['estimated_cost'],
            'reason': f"Selected {selected['model']} (rank #{selected['rank']}) for {analysis['task_type']} task",
            'analysis': analysis
        }
    
    def _estimate_tokens(self, text: str) -> int:
        """–û—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (–ø—Ä–∏–º–µ—Ä–Ω–æ 1 —Ç–æ–∫–µ–Ω = 4 —Å–∏–º–≤–æ–ª–∞)"""
        return len(text) // 4 + 500  # +500 –¥–ª—è –æ—Ç–≤–µ—Ç–∞
    
    def _estimate_request_cost(self, estimated_tokens: int, 
                               credits_per_1k: int) -> int:
        """–í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ –≤ –∫—Ä–µ–¥–∏—Ç–∞—Ö"""
        return int((estimated_tokens / 1000) * credits_per_1k) + 1
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ AI Router

```python
# agents/ai_router.py
from agents.model_selector import ModelSelector
from agents.credit_manager import CreditManager

class AIRouter:
    def __init__(self):
        self.model_selector = ModelSelector(db)
        self.credit_manager = CreditManager(db)
    
    async def route_request(self, user_id: int, prompt: str, 
                           prefer_cheap: bool = False):
        """
        –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–±–æ—Ä–æ–º –º–æ–¥–µ–ª–∏
        """
        
        # 1. –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_credits = self.credit_manager.get_balance(user_id)
        
        if user_credits <= 0:
            raise Exception("Insufficient credits. Please purchase more.")
        
        # 2. –í—ã–±—Ä–∞—Ç—å –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        selection = self.model_selector.select_model(
            prompt=prompt,
            user_credits=user_credits,
            prefer_cheap=prefer_cheap
        )
        
        # 3. –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
        self.credit_manager.reserve_credits(
            user_id=user_id,
            amount=selection['estimated_cost_credits']
        )
        
        try:
            # 4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
            response, actual_tokens = await self._call_ai_api(
                provider=selection['provider'],
                model=selection['model'],
                prompt=prompt
            )
            
            # 5. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å
            actual_cost = self._calculate_actual_cost(
                provider=selection['provider'],
                model=selection['model'],
                tokens=actual_tokens
            )
            
            # 6. –°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å)
            self.credit_manager.charge_credits(
                user_id=user_id,
                amount=actual_cost,
                description=f"Used {selection['model']} - {selection['analysis']['task_type']} task",
                request_id=request_id
            )
            
            # 7. –í–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
            return {
                'response': response,
                'model_used': selection['model'],
                'credits_spent': actual_cost,
                'remaining_credits': user_credits - actual_cost,
                'tokens_used': actual_tokens,
                'selection_reason': selection['reason']
            }
            
        except Exception as e:
            # –û—Ç–∫–∞—Ç–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            self.credit_manager.release_reserved_credits(user_id)
            raise e
```

### Credit Manager

```python
# agents/credit_manager.py
class CreditManager:
    """
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    """
    
    def __init__(self, db: HistoryDatabase):
        self.db = db
    
    def get_balance(self, user_id: int) -> int:
        """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤"""
        credits = self.db.get_user_credits(user_id)
        return credits['balance'] if credits else 0
    
    def add_credits(self, user_id: int, amount: int, 
                   transaction_type: str = 'purchase',
                   description: str = None, payment_id: int = None):
        """–î–æ–±–∞–≤–∏—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
        
        current_balance = self.get_balance(user_id)
        new_balance = current_balance + amount
        
        # –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
        self.db.update_user_credits(user_id, new_balance)
        
        # –ó–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        self.db.record_credit_transaction(
            user_id=user_id,
            type=transaction_type,
            amount=amount,
            balance_before=current_balance,
            balance_after=new_balance,
            description=description or f"Added {amount} credits",
            payment_id=payment_id
        )
        
        return new_balance
    
    def charge_credits(self, user_id: int, amount: int,
                      description: str = None, request_id: int = None):
        """–°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
        
        current_balance = self.get_balance(user_id)
        
        if current_balance < amount:
            raise Exception(f"Insufficient credits. Have: {current_balance}, Need: {amount}")
        
        new_balance = current_balance - amount
        
        # –û–±–Ω–æ–≤–∏—Ç—å –±–∞–ª–∞–Ω—Å
        self.db.update_user_credits(user_id, new_balance)
        
        # –ó–∞–ø–∏—Å–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
        self.db.record_credit_transaction(
            user_id=user_id,
            type='spend',
            amount=-amount,  # –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            balance_before=current_balance,
            balance_after=new_balance,
            description=description or f"Spent {amount} credits",
            request_id=request_id
        )
        
        return new_balance
    
    def reserve_credits(self, user_id: int, amount: int):
        """
        –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
        (–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è overdraft)
        """
        # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏
        # –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ 'reserved_credits' –≤ user_credits
        pass
    
    def get_transaction_history(self, user_id: int, 
                                limit: int = 50) -> List[Dict]:
        """–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π"""
        return self.db.get_credit_transactions(user_id, limit)
```

---

## üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ü–æ–∫—É–ø–∫–∞ –ö—Ä–µ–¥–∏—Ç–æ–≤

```typescript
// web-ui/app/credits/buy/page.tsx
export default function BuyCredits() {
  const [packages, setPackages] = useState<CreditPackage[]>([]);
  
  return (
    <div className="p-6">
      <h1>–ö—É–ø–∏—Ç—å –ö—Ä–µ–¥–∏—Ç—ã</h1>
      
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {packages.map(pkg => (
          <CreditPackageCard
            key={pkg.id}
            name={pkg.name}
            credits={pkg.credits}
            bonus={pkg.bonus_credits}
            price={pkg.price_usd}
            discount={pkg.discount_percentage}
            onSelect={() => handlePurchase(pkg)}
          />
        ))}
      </div>
      
      {/* –ö–∞—Å—Ç–æ–º–Ω–∞—è —Å—É–º–º–∞ */}
      <CustomAmountForm />
    </div>
  );
}

function CreditPackageCard({ name, credits, bonus, price, discount, onSelect }) {
  const totalCredits = credits + bonus;
  const pricePerCredit = (price / totalCredits).toFixed(3);
  
  return (
    <div className="border rounded-lg p-6 hover:shadow-lg transition">
      <h3 className="text-xl font-bold">{name}</h3>
      
      <div className="my-4">
        <p className="text-3xl font-bold">{credits}</p>
        <p className="text-sm text-gray-500">–∫—Ä–µ–¥–∏—Ç–æ–≤</p>
        {bonus > 0 && (
          <p className="text-green-500">+{bonus} –±–æ–Ω—É—Å!</p>
        )}
      </div>
      
      <div className="mb-4">
        <p className="text-2xl font-bold">${price}</p>
        <p className="text-sm text-gray-500">
          ${pricePerCredit} –∑–∞ –∫—Ä–µ–¥–∏—Ç
        </p>
        {discount > 0 && (
          <span className="bg-red-500 text-white px-2 py-1 rounded text-sm">
            -{discount}%
          </span>
        )}
      </div>
      
      <button onClick={onSelect} className="w-full btn-primary">
        –ö—É–ø–∏—Ç—å
      </button>
    </div>
  );
}
```

### 2. Dashboard –ö—Ä–µ–¥–∏—Ç–æ–≤

```typescript
// web-ui/app/dashboard/credits/page.tsx
export default function CreditsDashboard() {
  const { balance, history, stats } = useCredits();
  
  return (
    <div className="p-6">
      {/* –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å */}
      <div className="bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg p-6 text-white mb-6">
        <h2 className="text-xl mb-2">–í–∞—à –ë–∞–ª–∞–Ω—Å</h2>
        <p className="text-5xl font-bold">{balance}</p>
        <p className="text-sm">–∫—Ä–µ–¥–∏—Ç–æ–≤</p>
        
        <button className="mt-4 bg-white text-blue-500 px-4 py-2 rounded">
          –ö—É–ø–∏—Ç—å –ï—â–µ
        </button>
      </div>
      
      {/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
      <div className="grid grid-cols-3 gap-4 mb-6">
        <StatCard title="–ü–æ—Ç—Ä–∞—á–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è" value={stats.spentToday} />
        <StatCard title="–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ" value={stats.totalSpent} />
        <StatCard title="–í—Å–µ–≥–æ –∫—É–ø–ª–µ–Ω–æ" value={stats.totalPurchased} />
      </div>
      
      {/* –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π */}
      <div className="bg-white rounded-lg shadow p-6">
        <h3 className="text-xl font-bold mb-4">–ò—Å—Ç–æ—Ä–∏—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
        <table className="w-full">
          <thead>
            <tr>
              <th>–î–∞—Ç–∞</th>
              <th>–¢–∏–ø</th>
              <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
              <th>–ö—Ä–µ–¥–∏—Ç—ã</th>
              <th>–ë–∞–ª–∞–Ω—Å</th>
            </tr>
          </thead>
          <tbody>
            {history.map(tx => (
              <tr key={tx.id}>
                <td>{formatDate(tx.created_at)}</td>
                <td>
                  <TransactionTypeBadge type={tx.type} />
                </td>
                <td>{tx.description}</td>
                <td className={tx.amount > 0 ? 'text-green-500' : 'text-red-500'}>
                  {tx.amount > 0 ? '+' : ''}{tx.amount}
                </td>
                <td>{tx.balance_after}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}
```

### 3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –°—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ –ß–∞—Ç–µ

```typescript
// web-ui/components/ChatInput.tsx
export default function ChatInput({ onSend }) {
  const [message, setMessage] = useState('');
  const [estimatedCost, setEstimatedCost] = useState(0);
  const { balance } = useCredits();
  
  // –û—Ü–µ–Ω–∏–≤–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ –º–µ—Ä–µ –≤–≤–æ–¥–∞
  useEffect(() => {
    if (message.length > 10) {
      const cost = estimateMessageCost(message);
      setEstimatedCost(cost);
    }
  }, [message]);
  
  return (
    <div className="chat-input">
      <textarea
        value={message}
        onChange={(e) => setMessage(e.target.value)}
        placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å..."
      />
      
      {/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ */}
      <div className="flex justify-between items-center mt-2">
        <div className="text-sm text-gray-500">
          –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å: ~{estimatedCost} –∫—Ä–µ–¥–∏—Ç–æ–≤
        </div>
        <div className="text-sm">
          –ë–∞–ª–∞–Ω—Å: {balance} –∫—Ä–µ–¥–∏—Ç–æ–≤
        </div>
      </div>
      
      <button 
        onClick={() => onSend(message)}
        disabled={balance < estimatedCost}
      >
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
      </button>
    </div>
  );
}
```

---

## üéØ –ê–¥–º–∏–Ω-–ü–∞–Ω–µ–ª—å –¥–ª—è –°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞

### 1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–∫–µ—Ç–∞–º–∏ –ö—Ä–µ–¥–∏—Ç–æ–≤

```typescript
// web-ui/app/admin/credit-packages/page.tsx
export default function CreditPackagesAdmin() {
  return (
    <div>
      <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–∞–∫–µ—Ç–∞–º–∏ –ö—Ä–µ–¥–∏—Ç–æ–≤</h1>
      
      <table>
        <thead>
          <tr>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–ö—Ä–µ–¥–∏—Ç—ã</th>
            <th>–ë–æ–Ω—É—Å</th>
            <th>–¶–µ–Ω–∞</th>
            <th>–°–∫–∏–¥–∫–∞</th>
            <th>$/–∫—Ä–µ–¥–∏—Ç</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {packages.map(pkg => (
            <tr key={pkg.id}>
              <td><input value={pkg.name} onChange={...} /></td>
              <td><input type="number" value={pkg.credits} /></td>
              <td><input type="number" value={pkg.bonus_credits} /></td>
              <td><input type="number" value={pkg.price_usd} /></td>
              <td><input type="number" value={pkg.discount_percentage} />%</td>
              <td>${(pkg.price_usd / (pkg.credits + pkg.bonus_credits)).toFixed(3)}</td>
              <td>
                <button onClick={() => save(pkg)}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onClick={() => delete(pkg)}>–£–¥–∞–ª–∏—Ç—å</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
      
      <button onClick={addNew}>+ –ù–æ–≤—ã–π –ü–∞–∫–µ—Ç</button>
    </div>
  );
}
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –°—Ç–æ–∏–º–æ—Å—Ç–∏ –ú–æ–¥–µ–ª–µ–π

```typescript
// web-ui/app/admin/model-costs/page.tsx
export default function ModelCostsAdmin() {
  return (
    <div>
      <h1>–°—Ç–æ–∏–º–æ—Å—Ç—å –ú–æ–¥–µ–ª–µ–π –≤ –ö—Ä–µ–¥–∏—Ç–∞—Ö</h1>
      
      <table>
        <thead>
          <tr>
            <th>–ü—Ä–æ–≤–∞–π–¥–µ—Ä</th>
            <th>–ú–æ–¥–µ–ª—å</th>
            <th>–ö—Ä–µ–¥–∏—Ç–æ–≤/1K —Ç–æ–∫–µ–Ω–æ–≤</th>
            <th>–ë–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å USD</th>
            <th>–ù–∞—Ü–µ–Ω–∫–∞ %</th>
            <th>–ê–∫—Ç–∏–≤–Ω–∞</th>
          </tr>
        </thead>
        <tbody>
          {models.map(model => (
            <tr key={model.id}>
              <td>{model.provider}</td>
              <td>{model.model}</td>
              <td>
                <input 
                  type="number" 
                  value={model.credits_per_1k_tokens}
                  onChange={(e) => updateCost(model.id, e.target.value)}
                />
              </td>
              <td>${model.base_cost_usd}</td>
              <td>{model.markup_percentage}%</td>
              <td>
                <Toggle 
                  checked={model.is_active}
                  onChange={(v) => toggleActive(model.id, v)}
                />
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –°—É–ø–µ—Ä–∞–¥–º–∏–Ω–∞

```typescript
// web-ui/app/admin/analytics/credits/page.tsx
export default function CreditsAnalytics() {
  return (
    <div>
      <h1>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ö—Ä–µ–¥–∏—Ç–æ–≤</h1>
      
      {/* –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ */}
      <div className="grid grid-cols-4 gap-4">
        <MetricCard 
          title="–ü—Ä–æ–¥–∞–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤ (—Å–µ–≥–æ–¥–Ω—è)"
          value={metrics.credits–°oldToday}
          revenue={`$${metrics.revenueToday}`}
        />
        <MetricCard 
          title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –∫—Ä–µ–¥–∏—Ç–æ–≤"
          value={metrics.creditsSpentToday}
        />
        <MetricCard 
          title="–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
          value={metrics.activeUsers}
        />
        <MetricCard 
          title="–°—Ä–µ–¥–Ω–∏–π —á–µ–∫"
          value={`$${metrics.averagePurchase}`}
        />
      </div>
      
      {/* –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–¥–∞–∂ –∫—Ä–µ–¥–∏—Ç–æ–≤ */}
      <CreditSalesChart data={salesData} />
      
      {/* –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–∞–∫–µ—Ç—ã */}
      <PopularPackagesChart packages={packageStats} />
      
      {/* –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º */}
      <TopSpendersTable users={topSpenders} />
    </div>
  );
}
```

---

## üöÄ –ü–ª–∞–Ω –í–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö (1 —á–∞—Å)
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `user_credits`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `credit_transactions`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `credit_packages`
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É `model_credit_costs`
- [ ] –†–∞—Å—à–∏—Ä–∏—Ç—å `ai_model_rankings`

### –§–∞–∑–∞ 2: Backend - Credit System (2 —á–∞—Å–∞)
- [ ] –°–æ–∑–¥–∞—Ç—å `CreditManager`
- [ ] API –¥–ª—è –ø–æ–∫—É–ø–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ (`/api/credits/purchase`)
- [ ] API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ (`/api/credits/balance`)
- [ ] API –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`/api/credits/history`)
- [ ] Webhook –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π (Stripe/PayPal)

### –§–∞–∑–∞ 3: Backend - Model Selector (2 —á–∞—Å–∞)
- [ ] –°–æ–∑–¥–∞—Ç—å `ModelSelector`
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `AIRouter`
- [ ] API –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ (`/api/estimate-cost`)
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤

### –§–∞–∑–∞ 4: Frontend - User (2 —á–∞—Å–∞)
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫—É–ø–∫–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤ (`/credits/buy`)
- [ ] Dashboard –∫—Ä–µ–¥–∏—Ç–æ–≤ (`/dashboard/credits`)
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –±–∞–ª–∞–Ω—Å–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –≤ —á–∞—Ç–µ

### –§–∞–∑–∞ 5: Frontend - Admin (2 —á–∞—Å–∞)
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–∞–º–∏ –∫—Ä–µ–¥–∏—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–æ–¥–µ–ª–µ–π
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –∫—Ä–µ–¥–∏—Ç–æ–≤
- [ ] –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –§–∞–∑–∞ 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)
- [ ] –¢–µ—Å—Ç—ã —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- [ ] –¢–µ—Å—Ç—ã —Å–ø–∏—Å–∞–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–æ–≤
- [ ] –¢–µ—Å—Ç—ã –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–µ–π
- [ ] E2E —Ç–µ—Å—Ç—ã –ø–æ–∫—É–ø–∫–∏

**–û–±—â–µ–µ –≤—Ä–µ–º—è**: ~10 —á–∞—Å–æ–≤ –ø–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç (3 —á–∞—Å–∞)

### –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è:

1. **–ë–∞–∑–∞** (30 –º–∏–Ω):
```sql
CREATE TABLE user_credits (
    user_id INTEGER PRIMARY KEY,
    balance INTEGER DEFAULT 0
);

ALTER TABLE requests ADD COLUMN credits_spent INTEGER DEFAULT 0;
```

2. **Backend** (1.5 —á–∞—Å–∞):
```python
# –ü—Ä–æ—Å—Ç–æ–π credit manager
class SimpleCreditManager:
    def charge(user_id, credits):
        # –°–ø–∏—Å–∞—Ç—å –∫—Ä–µ–¥–∏—Ç—ã
        pass
    
    def get_balance(user_id):
        # –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
        pass
```

3. **Frontend** (1 —á–∞—Å):
```typescript
// –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏ –∏—Å—Ç–æ—Ä–∏—é
function CreditsWidget() {
  return <div>–ë–∞–ª–∞–Ω—Å: {balance} –∫—Ä–µ–¥–∏—Ç–æ–≤</div>
}
```

---

**–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ?** üöÄ
