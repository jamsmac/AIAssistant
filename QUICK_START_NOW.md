# üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ - –°–î–ï–õ–ê–ô –°–ï–ô–ß–ê–°

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω–æ–≤–∏—Ç–µ Webhook URL!

### –®–∞–≥ 0: –û–±–Ω–æ–≤–∏—Ç–µ URL –≤ Stripe (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)

**–ë–ï–ó –≠–¢–û–ì–û –ö–†–ï–î–ò–¢–´ –ù–ï –î–û–ë–ê–í–Ø–¢–°–Ø!**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://dashboard.stripe.com/test/webhooks
2. –ù–∞–π–¥–∏—Ç–µ: `we_1SR4zwBk4MbPWMlrQLAtGDgw`
3. –ù–∞–∂–º–∏—Ç–µ "..." ‚Üí "Update details"
4. –í –ø–æ–ª–µ "Endpoint URL" –≤–≤–µ–¥–∏—Ç–µ:
   ```
   https://aiassistant-production-7a4d.up.railway.app/api/credits/webhook
   ```
5. –ù–∞–∂–º–∏—Ç–µ "Update endpoint"
6. –°—Ä–∞–∑—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ:
   - –í–∫–ª–∞–¥–∫–∞ "Testing"
   - –í—ã–±–µ—Ä–∏—Ç–µ `checkout.session.completed`
   - "Send test webhook"
   - –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: ‚úÖ **200 OK**

**–ï—Å–ª–∏ –≤–µ—Ä–Ω—É–ª—Å—è 200 OK - –æ—Ç–ª–∏—á–Ω–æ! –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Ç–µ—Å—Ç—É –æ–ø–ª–∞—Ç—ã.**

---

## üß™ –¢–µ—Å—Ç 1: –†–µ–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç
```
https://aiassistant-4h266kq8h-vendhubs-projects.vercel.app
```

### 2. –í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π email
- –ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤

### 3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Credits
- –ò—â–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Credits" –∏–ª–∏ "Pricing"
- –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é: `/credits` –∏–ª–∏ `/pricing`

### 4. –í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç Starter ($10)
- 1,000 –∫—Ä–µ–¥–∏—Ç–æ–≤
- $10.00

### 5. –í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
```
–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã: 4242 4242 4242 4242
CVC: 123
Expiry: 12/25
–ò–º—è: Test User
–ü–æ—á—Ç–æ–≤—ã–π –∫–æ–¥: 12345
```

### 6. –ù–∞–∂–º–∏—Ç–µ "Pay"

### 7. –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏:
1. ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ Stripe
2. ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
3. ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å–∞–π—Ç
4. ‚úÖ **–ö—Ä–µ–¥–∏—Ç—ã –¥–æ–±–∞–≤–∏–ª–∏—Å—å –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç**

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å –∫—Ä–µ–¥–∏—Ç–æ–≤ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –∏–ª–∏ –¥–∞—à–±–æ—Ä–¥–µ.  
–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: **1,000 credits**

### –í Stripe Dashboard
```
https://dashboard.stripe.com/test/payments
```
–î–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø–ª–∞—Ç–µ–∂ –Ω–∞ $10.00 ‚úÖ

### –í –ª–æ–≥–∞—Ö Railway
```bash
railway logs --service a356894b-78b6-4746-8cf4-69103f40b474 | tail -20
```

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
```
‚úÖ Webhook received for checkout session...
‚úÖ Successfully added 1000 credits to user X...
```

---

## üö® –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: 404 NOT FOUND

**–ü—Ä–∏—á–∏–Ω–∞:** Webhook URL –Ω–µ –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Stripe

**–†–µ—à–µ–Ω–∏–µ:**
```
1. Stripe Dashboard ‚Üí Webhooks
2. –û–±–Ω–æ–≤–∏—Ç–µ URL –Ω–∞:
   https://aiassistant-production-7a4d.up.railway.app/api/credits/webhook
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–Ω–æ–≤–∞
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö—Ä–µ–¥–∏—Ç—ã –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏—Å—å

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**

1. **Webhook URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?**
   ```
   https://aiassistant-production-7a4d.up.railway.app/api/credits/webhook
   ```

2. **Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200?**
   ```
   Stripe Dashboard ‚Üí Webhook ‚Üí Testing ‚Üí Send test webhook
   ```

3. **–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É?**
   ```bash
   railway logs | grep -i error
   ```

4. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã?**
   ```bash
   railway variables | grep STRIPE
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: Payment failed

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É `4242 4242 4242 4242`?
- –î–∞—Ç–∞ –Ω–µ –∏—Å—Ç–µ–∫–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12/25)?
- CVC –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, 123)?

---

## ‚úÖ Checklist

–ü–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] Webhook URL –æ–±–Ω–æ–≤–ª–µ–Ω –≤ Stripe Dashboard
- [ ] Webhook —Ç–µ—Å—Ç –≤–µ—Ä–Ω—É–ª 200 OK
- [ ] Railway –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (STRIPE_*)
- [ ] Frontend —Å–∞–π—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] Backend —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ /api/health)

---

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ CLI

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
stripe trigger checkout.session.completed
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
railway logs | grep webhook
```

---

## üìû –°—Ä–æ—á–Ω–∞—è –ø–æ–º–æ—â—å

–ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω:**
   ```bash
   curl https://aiassistant-production-7a4d.up.railway.app/api/health
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Railway –ª–æ–≥–∏:**
   ```bash
   railway logs --service a356894b-78b6-4746-8cf4-69103f40b474
   ```

3. **–†–µ—Å—Ç–∞—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
   ```bash
   railway restart --service a356894b-78b6-4746-8cf4-69103f40b474
   ```

---

## üéâ –£—Å–ø–µ—Ö!

–ï—Å–ª–∏ –∫—Ä–µ–¥–∏—Ç—ã –¥–æ–±–∞–≤–∏–ª–∏—Å—å - **–ø–æ–∑–¥—Ä–∞–≤–ª—è—é!** 

Stripe –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. üöÄ

–¢–µ–ø–µ—Ä—å –º–æ–∂–µ—Ç–µ:
- ‚úÖ –ü—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∫—Ä–µ–¥–∏—Ç—ã
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Stripe Dashboard
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ production

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 5 –º–∏–Ω—É—Ç  
**–î–∞—Ç–∞:** 08.11.2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û–±–Ω–æ–≤–∏—Ç–µ webhook URL –≤ Stripe –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–ø–ª–∞—Ç—É! üöÄ
