# AI Assistant Platform - Cursor Rules

Python/FastAPI backend + Next.js 16 frontend + MCP Integration

## Priority Rules (ALWAYS CHECK FIRST)
1. ğŸ” SECURITY: NEVER expose API keys, use .env
2. ğŸ” VALIDATION: ALWAYS use Pydantic for inputs
3. ğŸ” AUTH: JWT required for protected routes
4. ğŸ“ TYPES: Strict TypeScript (NO 'any')
5. ğŸ¨ STYLING: TailwindCSS only (NO inline styles)

## MCP Integration (NEW!)
- **12 MCP Tools Available** via `ai-assistant-platform` server
- Test: `python test_mcp_server.py`
- Config: `.cursor/mcp.json`
- Docs: `MCP_SETUP_GUIDE.md`, `MCP_README.md`

### Available MCP Tools:
1. Projects: `create_project`, `list_projects`
2. Databases: `create_database`, `list_databases`, `query_database`, `create_record`
3. AI Chat: `chat`, `list_chat_sessions`
4. Workflows: `execute_workflow`, `list_workflows`
5. Analytics: `get_stats`, `get_model_rankings`

## Current Features
- 6 AI models with smart routing (Gemini, GPT-4, Claude, DeepSeek, Grok)
- JWT authentication + bcrypt password hashing
- Request caching (920x speedup, MD5-based)
- Rate limiting (3-tier: anonymous, authenticated, premium)
- Streaming chat (SSE)
- Session memory (10 messages context)
- 30+ API endpoints
- MCP Server with 12 tools
- Projects & custom databases with dynamic schemas
- Workflows & integrations
- AI model rankings (7 categories)

## Key Files
- `agents/database.py` - HistoryDatabase class (SQLite ORM)
- `agents/ai_router.py` - Smart model routing + caching (includes MODELS config)
- `agents/auth.py` - JWT authentication
- `agents/mcp_server.py` - **MCP server with 12 tools**
- `agents/rate_limiter.py` - Three-tier rate limiting
- `agents/workflow_engine.py` - Workflow execution
- `api/server.py` - FastAPI application (30+ endpoints)
- `web-ui/app/chat/page.tsx` - Streaming chat UI
- `web-ui/lib/api.ts` - API client

## Development Commands
```bash
# Backend
python api/server.py              # Start FastAPI server (port 8000)

# Frontend
cd web-ui && npm run dev          # Start Next.js dev server (port 3000)

# Testing
python test_mcp_server.py         # Test MCP server (12 tools)
python scripts/smoke_test.py      # Integration tests
python -m pytest tests/           # Unit tests

# Database
python -c "from agents.database import HistoryDatabase; db = HistoryDatabase()"

# MCP
./start_mcp_server.sh             # Start MCP server manually
```

## Security Rules (CRITICAL!)
- âœ… ALWAYS validate inputs with Pydantic models
- âœ… NEVER commit .env files to git
- âœ… JWT required for all protected routes
- âœ… Rate limiting on public endpoints
- âœ… bcrypt for password hashing (12 rounds)
- âœ… CORS properly configured
- âœ… SQL injection prevention via parameterized queries
- âœ… XSS prevention via proper escaping

## Code Style Rules

### Python
```python
# âœ… GOOD
from typing import Optional, Dict, List
from pydantic import BaseModel, Field

class UserCreate(BaseModel):
    email: str = Field(..., min_length=5)
    password: str = Field(..., min_length=8)

def create_user(data: UserCreate) -> Dict[str, Any]:
    """Create new user with validation."""
    try:
        # Implementation
        return {"success": True, "user_id": 1}
    except Exception as e:
        logger.error(f"User creation failed: {e}")
        raise

# âŒ BAD
def create_user(email, password):  # No types!
    # No validation, no error handling
    return db.insert(email, password)
```

### TypeScript
```typescript
// âœ… GOOD
interface User {
  id: number;
  email: string;
  createdAt: Date;
}

async function createUser(data: UserCreate): Promise<User> {
  try {
    const response = await api.post('/users', data);
    return response.data;
  } catch (error) {
    console.error('User creation failed:', error);
    throw new Error('Failed to create user');
  }
}

// âŒ BAD
async function createUser(data: any) {  // NO 'any'!
  const response = await api.post('/users', data);
  return response.data;  // No error handling!
}
```

## Documentation
- `README.md` - Main documentation
- `MCP_SETUP_GUIDE.md` - MCP setup (detailed)
- `MCP_README.md` - MCP API reference
- `MCP_Ğ‘Ğ«Ğ¡Ğ¢Ğ Ğ«Ğ™_Ğ¡Ğ¢ĞĞ Ğ¢.md` - MCP quick start (Russian)
- `DEPLOYMENT_GUIDE.md` - Production deployment
- `CURSOR_MCP_RECOMMENDATIONS.md` - Cursor/MCP config guide

## Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Cursor IDE with MCP Tools       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MCP Server â”‚    â”‚   FastAPI     â”‚
â”‚ 12 tools   â”‚â—„â”€â”€â”€â”¤   Backend     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                 â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â”‚   SQLite    â”‚   â”‚ AI Models  â”‚
       â”‚   Database  â”‚   â”‚  6 models  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## When to Use MCP Tools
Use MCP tools in Cursor IDE when you need to:
- ğŸ“ Create/list projects programmatically
- ğŸ’¾ Query databases with complex filters
- ğŸ¤– Test AI chat routing
- âš™ï¸ Execute workflows from IDE
- ğŸ“Š Get real-time analytics

Example prompts:
```
"List all projects using the MCP tool"
"Create a new database with customer schema"
"Get platform statistics for last 30 days"
"Execute workflow 5 with test data"
```

## Response Format for AI
When generating code:
1. âœ… Read relevant documentation first
2. âœ… Follow security rules (validation, auth, no keys)
3. âœ… Use strict types (Python: type hints, TS: interfaces)
4. âœ… Add error handling (try/except, try/catch)
5. âœ… Add docstrings/comments for complex logic
6. âœ… Test with provided test commands
7. âœ… Explain which patterns you followed

---

**Last Updated:** 2025-11-04
**MCP Integration:** v1.0 (12 tools)
**Project Version:** v1.0.0
